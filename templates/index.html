<!doctype html>
<html lang="ru" data-theme="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Chat UI (SOZD)</title>
  <link rel="stylesheet" type="text/css" href="/static/css/styles.css" />
  <link rel="shortcut icon" href="/static/image/chat.png" >
</head>
<body>
  <div class="app">
    <!-- Sidebar -->
    <aside class="sidebar" aria-label="History sidebar">
      <div class="sidebar-top">
        <div class="sidebar-buttons">
          <div class="tools-menu-container">
            <button id="toolsBtn" class="btn btn-ghost btn-icon" title="–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã">‚öôÔ∏è</button>
            <div id="toolsMenu" class="tools-menu" style="display: none;">
              <div class="tools-menu-item" id="adminPanelMenuItem" style="display: none;">
                <span class="tools-menu-icon">‚öôÔ∏è</span>
                <span>–ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</span>
              </div>
              <div class="tools-menu-item" id="newLoginMenuItem">
                <span class="tools-menu-icon">üîÑ</span>
                <span>–í–æ–π—Ç–∏ –ø–æ–¥ –¥—Ä—É–≥–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º</span>
              </div>
              <div class="tools-menu-item" id="showVersionBtn">
                <span class="tools-menu-icon">‚ÑπÔ∏è</span>
                <span>–í–µ—Ä—Å–∏—è API gemini</span>
              </div>
              <div class="tools-menu-item" id="clearCacheBtn">
                <span class="tools-menu-icon">üóëÔ∏è</span>
                <span>–û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à</span>
              </div>
              <div class="tools-menu-item" id="clearSchemaCacheBtn">
                <span class="tools-menu-icon">üßπ</span>
                <span>–û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à —Å—Ö–µ–º—ã</span>
              </div>
            </div>
          </div>
          <button id="newChatBtn" class="btn btn-primary">+ New chat</button>
          <!-- –ö–Ω–æ–ø–∫–∏ —Ä–µ–∂–∏–º–æ–≤ —Å–ø—Ä–∞–≤–∞ –æ—Ç New chat -->
          <div id="queryModeTabs" class="mode-tabs-inline">
            <!-- –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∏–∑ config.js -->
          </div>
        </div>
        <div id="versionInfo" class="version-info"></div>
          <!--
          <select id="themeSelect" class="input">
            <option value="dark">Dark</option>
            <option value="light">Light</option>
          </select>
          -->
      </div>

      <div class="sidebar-search">
        <input id="searchInput" class="input" placeholder="Search chats‚Ä¶" />
      </div>

      <div id="chatList" class="chat-list" role="list"
        title="üí° –î–≤–æ–π–Ω–æ–π –∫–ª–∏–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é —á–∞—Ç–∞ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è"></div>

      <div class="sidebar-bottom">
        <div class="user-chip">
          <div class="avatar" id="userAvatar">U</div>
          <div class="user-meta">
            <div class="user-name" id="userName">Loading...</div>
            <div class="user-sub" id="userEmailDisplay">...</div>
          </div>
        </div>
        <button id="logoutBtn" class="btn btn-ghost" style="margin-top: 0.5rem; width: 100%;" title="–í—ã–π—Ç–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã">–í—ã–π—Ç–∏</button>
      </div>
    </aside>

    <!-- –°—Ç–∞—Ä–∞—è –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–∞—è –ø–∞–Ω–µ–ª—å —Ä–µ–∂–∏–º–æ–≤ —É–¥–∞–ª–µ–Ω–∞, —Ç–µ–ø–µ—Ä—å –∫–Ω–æ–ø–∫–∏ –≤ sidebar-buttons -->

    <!-- Main -->
    <main class="main">
      <header class="topbar">
        <div class="title-wrap">
          <div id="chatTitle" class="chat-title">New chat</div>
        </div>
        <div class="topbar-actions">
          <select id="dbSchemaSelect" class="input db-schema-select" title="–í—ã–±–æ—Ä —Å—Ö–µ–º—ã –ë–î">
            <!-- –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∏–∑ config.js -->
          </select>
          <button id="themeToggle" class="btn btn-ghost" title="Toggle theme">
            üåô
          </button>
          <button id="clearBtn" class="btn btn-ghost" title="–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–≥–æ —á–∞—Ç–∞">Clear</button>
          <button type="button" id="scrollToEndBtn" class="btn" title="–í –∫–æ–Ω–µ—Ü –ª–µ–Ω—Ç—ã">‚Üì</button>
          <button type="button" id="scrollToTopBtn" class="btn" title="–í –Ω–∞—á–∞–ª–æ –ª–∫–Ω—Ç—ã">‚Üë</button>
          <button id="exportBtn" class="btn btn-ghost" title="–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ —á–∞—Ç—ã –≤ JSON —Ñ–∞–π–ª">Export</button>
          <button id="toggleAllBtn" class="btn btn-outline" title="–°–≤–µ—Ä–Ω—É—Ç—å/—Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è">‚àí</button>

        </div>


      </header>

        <section class="messages-wrap" aria-label="Messages">
          <div id="messages" class="messages"></div>

          <div id="genOverlay" class="gen-overlay" aria-live="polite">
            <div class="gen-card">
              <div class="gen-spinner"></div>
              <div class="gen-text">Generating response‚Ä¶</div>
            </div>
          </div>
        </section>

      <footer class="composer">
        <form id="composerForm" class="composer-form" autocomplete="off">
          <div class="composer-box">
            <button id="clearQueryCacheBtn" class="btn btn-ghost btn-icon btn-clear-query-cache" type="button" title="–û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à —ç—Ç–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞" style="display: none;">
              üóëÔ∏è
            </button>
            <textarea
              id="promptInput"
              class="composer-input"
              rows="1"
              placeholder="Message‚Ä¶"
            ></textarea>
            <div class="composer-actions">
              <button id="voiceBtn" class="btn btn-voice" type="button" title="–ì–æ–ª–æ—Å–æ–≤–æ–π –≤–≤–æ–¥">
                <span class="voice-icon">üé§</span>
              </button>
              <button id="sendBtn" class="btn btn-primary" type="submit">Send</button>
            </div>
          </div>
          <div class="composer-hint">
            <span>Shift+Enter ‚Äî –Ω–æ–≤–∞—è —Å—Ç—Ä–æ–∫–∞</span>
            <span class="dot">‚Ä¢</span>
            <span>Enter –≤ –∫–æ–Ω—Ü–µ ‚Äî –æ—Ç–ø—Ä–∞–≤–∏—Ç—å</span>
          </div>
        </form>
      </footer>
    </main>
  </div>
  <div id="uiBusy" class="ui-busy">‚è≥ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ‚Ä¶</div>

  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–æ–≤ -->
  <div id="chartModal" class="modal">
    <div class="modal-content chart-modal">
      <div class="modal-header">
        <h3>üìä –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö</h3>
        <button class="close-modal" title="–ó–∞–∫—Ä—ã—Ç—å">&times;</button>
      </div>
      <div class="chart-modal-body">
        <div class="chart-controls">
          <label for="chartTypeSelect">–¢–∏–ø –≥—Ä–∞—Ñ–∏–∫–∞:</label>
          <select id="chartTypeSelect" class="chart-type-select"></select>
          <button id="copyChartBtn" class="btn btn-sm btn-copy-chart" title="–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≥—Ä–∞—Ñ–∏–∫ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞">
            üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
          </button>
          <button id="resetZoomBtn" class="btn btn-sm btn-reset-zoom" title="–°–±—Ä–æ—Å–∏—Ç—å –º–∞—Å—à—Ç–∞–±">
            üîÑ –°–±—Ä–æ—Å
          </button>
        </div>
        <div id="chartContainer" class="chart-container"></div>
      </div>
    </div>
  </div>

  <!-- Chart.js –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–æ–≤ -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <!-- Chart.js –ø–ª–∞–≥–∏–Ω—ã -->
  <script src="https://cdn.jsdelivr.net/npm/hammerjs@2.0.8"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@2.0.1"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.min.js"></script>
  <!-- Markdown renderer (lightweight) -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <!-- Optional: code highlighting (DISABLED due to require error) -->
  <!-- <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.10.0/build/highlight.min.js"></script> -->

  <!-- Admin Panel Modal -->
  <div id="adminModal" class="modal">
    <div class="modal-content admin-modal">
      <div class="modal-header">
        <h3>–ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h3>
        <button class="close-modal" type="button">&times;</button>
      </div>
      <div class="modal-body">
        <div class="admin-tabs">
          <button class="admin-tab active" data-tab="users" type="button">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</button>
          <button class="admin-tab" data-tab="activity" type="button">–ò—Å—Ç–æ—Ä–∏—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</button>
          <button id="addUserBtn" class="btn btn-primary admin-add-btn" type="button">+ –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</button>
        </div>

        <!-- Users Tab -->
        <div id="adminTabUsers" class="admin-tab-content">
          <div class="admin-table-container">
            <table class="admin-table">
              <thead>
                <tr>
                  <th>–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</th>
                  <th>Email</th>
                  <th>–°—Ç–∞—Ç—É—Å</th>
                  <th>–†–æ–ª—å</th>
                  <th>–î–æ—Å—Ç—É–ø–Ω—ã–µ —Å—Ö–µ–º—ã</th>
                  <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                </tr>
              </thead>
              <tbody id="usersTableBody">
                <tr><td colspan="6" style="text-align: center; padding: 2rem;">–ó–∞–≥—Ä—É–∑–∫–∞...</td></tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- Activity Tab -->
        <div id="adminTabActivity" class="admin-tab-content" style="display: none;">
          <div class="admin-filters">
            <select id="activityUserFilter" class="input">
              <option value="">–í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</option>
            </select>
            <button id="refreshActivityBtn" class="btn btn-outline" type="button">–û–±–Ω–æ–≤–∏—Ç—å</button>
          </div>

          <div class="admin-table-container">
            <table class="admin-table">
              <thead>
                <tr>
                  <th>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</th>
                  <th>–î–µ–π—Å—Ç–≤–∏–µ</th>
                  <th>–î–µ—Ç–∞–ª–∏</th>
                  <th>IP –∞–¥—Ä–µ—Å</th>
                  <th>–î–∞—Ç–∞</th>
                </tr>
              </thead>
              <tbody id="activityTableBody">
                <tr><td colspan="5" style="text-align: center; padding: 2rem;">–ó–∞–≥—Ä—É–∑–∫–∞...</td></tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- User Form Modal -->
  <div id="userFormModal" class="modal">
    <div class="modal-content" style="max-width: 600px;">
      <div class="modal-header">
        <h3 id="userFormTitle">–î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h3>
        <button class="close-modal" type="button">&times;</button>
      </div>
      <div class="modal-body">
        <form id="userForm">
          <input type="hidden" id="userId" name="userId">

          <div class="form-group">
            <label for="userUsername">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è *</label>
            <input type="text" id="userUsername" name="username" class="input" required>
          </div>

          <div class="form-group">
            <label for="userEmail">Email *</label>
            <input type="text" id="userEmail" name="email" class="input" required autocomplete="nope">
          </div>

          <div class="form-group" id="passwordGroup">
            <label for="userPassword">–ü–∞—Ä–æ–ª—å *</label>
            <input type="password" id="userPassword" name="password" class="input" minlength="6">
            <small style="color: var(--text-secondary); font-size: 0.875rem;">–ú–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤</small>
          </div>

          <div class="form-group">
            <label class="checkbox-label">
              <input type="checkbox" id="userIsAdmin" name="is_admin">
              <span>–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</span>
            </label>
          </div>

          <div class="form-group">
            <label class="checkbox-label">
              <input type="checkbox" id="userIsActive" name="is_active" checked>
              <span>–ê–∫—Ç–∏–≤–µ–Ω</span>
            </label>
          </div>

          <div class="form-group">
            <label>–î–æ—Å—Ç—É–ø –∫ —Å—Ö–µ–º–∞–º –ë–î:</label>
            <div id="schemaCheckboxes" class="schema-checkboxes">
              <label class="checkbox-label"><input type="checkbox" id="schema_sozd" name="schema_sozd"><span>–°–û–ó–î</span></label>
              <label class="checkbox-label"><input type="checkbox" id="schema_lib" name="schema_lib"><span>–ì–∞–∞–∑–µ</span></label>
              <label class="checkbox-label"><input type="checkbox" id="schema_family" name="schema_family"><span>–°–µ–º—å—è</span></label>
              <label class="checkbox-label"><input type="checkbox" id="schema_urban" name="schema_urban"><span>–ò–≥—Ä–∞</span></label>
              <label class="checkbox-label"><input type="checkbox" id="schema_eco" name="schema_eco"><span>–ì–ï–û-–≠–ö–û</span></label>
              <label class="checkbox-label"><input type="checkbox" id="schema_gen" name="schema_gen"><span>–ï–í–ì–ï–ù–ò–Ø</span></label>
              <label class="checkbox-label"><input type="checkbox" id="schema_ohi" name="schema_ohi"><span>–ù–∞—à –¥–æ–º –ò–∑—Ä–∞–∏–ª—å</span></label>
            </div>
          </div>

          <div class="form-actions">
            <button type="submit" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            <button type="button" class="btn btn-ghost close-modal">–û—Ç–º–µ–Ω–∞</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <script type="module" src="/static/js/app.js"></script>
</body>
</html>
