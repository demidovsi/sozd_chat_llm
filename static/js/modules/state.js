/**
 * Ð£Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸ÐµÐ¼ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ
 */

import { LS_KEY, DB_SCHEMA_KEY, QUERY_MODE_KEY, SCHEMA_MODES, getSchemaList, getModesForSchema, getModeConfig } from './config.js';

export let state = null;
export let currentAbortController = null;
export let isGenerating = false;
export let lastUserMessageCache = "";
export let restSessionId = null;
export let dbSchema = null;
export let queryMode = "sql"; // Ð¢ÐµÐºÑƒÑ‰Ð¸Ð¹ Ñ€ÐµÐ¶Ð¸Ð¼ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹ (Ð¿Ð¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ SQL)

export function setState(newState) {
  state = newState;
}

export function setCurrentAbortController(controller) {
  currentAbortController = controller;
}

export function setIsGenerating(value) {
  isGenerating = value;
}

export function setLastUserMessageCache(value) {
  lastUserMessageCache = value;
}

export function setRestSessionId(value) {
  restSessionId = value;
  // Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼ session_id Ð² localStorage
  if (value) {
    localStorage.setItem('restSessionId', value);
    console.log(`Session ID saved to localStorage: ${value}`);
  }
}

export function setDbSchema(value) {
  dbSchema = value;
  // Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼ db_schema Ð² localStorage
  if (value) {
    localStorage.setItem(DB_SCHEMA_KEY, value);
    console.log(`DB Schema saved to localStorage: ${value}`);
  }
}

export function setQueryMode(value) {
  queryMode = value;
  // Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼ query_mode Ð² localStorage
  if (value) {
    localStorage.setItem(QUERY_MODE_KEY, value);
    console.log(`Query Mode saved to localStorage: ${value}`);
  }
}

export function getCurrentMode() {
  const modeConfig = getModeConfig(dbSchema, queryMode);
  if (modeConfig) return modeConfig;

  // Fallback: ÐµÑÐ»Ð¸ Ñ€ÐµÐ¶Ð¸Ð¼ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½, Ð±ÐµÑ€ÐµÐ¼ Ð¿ÐµÑ€Ð²Ñ‹Ð¹ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹Ð¹ Ñ€ÐµÐ¶Ð¸Ð¼ Ð´Ð»Ñ ÑÑ…ÐµÐ¼Ñ‹
  const availableModes = getModesForSchema(dbSchema);
  const firstModeId = Object.keys(availableModes)[0];
  return availableModes[firstModeId] || null;
}

export function loadState() {
  // Ð—Ð°Ð³Ñ€ÑƒÐ¶Ð°ÐµÐ¼ session_id Ð¸Ð· localStorage
  const savedSessionId = localStorage.getItem('restSessionId');
  if (savedSessionId) {
    restSessionId = savedSessionId;
    console.log(`Session ID loaded from localStorage: ${savedSessionId}`);
  }

  // Ð—Ð°Ð³Ñ€ÑƒÐ¶Ð°ÐµÐ¼ db_schema Ð¸Ð· localStorage
  const savedDbSchema = localStorage.getItem(DB_SCHEMA_KEY);
  const schemaList = getSchemaList();

  if (savedDbSchema) {
    dbSchema = savedDbSchema;
    console.log(`DB Schema loaded from localStorage: ${savedDbSchema}`);
  } else {
    // ÐŸÐ¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ Ð¿ÐµÑ€Ð²Ð°Ñ ÑÑ…ÐµÐ¼Ð° (sozd)
    dbSchema = schemaList[0]?.value || 'sozd';
    localStorage.setItem(DB_SCHEMA_KEY, dbSchema);
  }

  // Ð—Ð°Ð³Ñ€ÑƒÐ¶Ð°ÐµÐ¼ query_mode Ð¸Ð· localStorage
  const savedQueryMode = localStorage.getItem(QUERY_MODE_KEY);
  const availableModes = getModesForSchema(dbSchema);

  if (savedQueryMode && availableModes[savedQueryMode]) {
    queryMode = savedQueryMode;
    console.log(`Query Mode loaded from localStorage: ${savedQueryMode}`);
  } else {
    // ÐŸÐ¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ Ð¿ÐµÑ€Ð²Ñ‹Ð¹ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹Ð¹ Ñ€ÐµÐ¶Ð¸Ð¼ Ð´Ð»Ñ ÑÑ…ÐµÐ¼Ñ‹
    queryMode = Object.keys(availableModes)[0] || "sql";
    localStorage.setItem(QUERY_MODE_KEY, queryMode);
    console.log(`Query Mode set to default: ${queryMode}`);
  }

  const raw = localStorage.getItem(LS_KEY);
  if (raw) {
    try {
      const data = JSON.parse(raw);

      // ÐœÐ¸Ð³Ñ€Ð°Ñ†Ð¸Ñ: Ð´Ð¾Ð±Ð°Ð²Ð»ÑÐµÐ¼ schema Ð¸ mode Ðº ÑÑ‚Ð°Ñ€Ñ‹Ð¼ Ñ‡Ð°Ñ‚Ð°Ð¼, Ð²Ð°Ð»Ð¸Ð´Ð¸Ñ€ÑƒÐµÐ¼ ÐºÐ¾Ð¼Ð±Ð¸Ð½Ð°Ñ†Ð¸Ð¸
      if (data.chats && Array.isArray(data.chats)) {
        data.chats.forEach(chat => {
          // Ð”Ð¾Ð±Ð°Ð²Ð»ÑÐµÐ¼ schema, ÐµÑÐ»Ð¸ Ð¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ð²ÑƒÐµÑ‚
          if (!chat.schema) {
            chat.schema = schemaList[0]?.value || 'sozd';
          }
          // Ð”Ð¾Ð±Ð°Ð²Ð»ÑÐµÐ¼ mode, ÐµÑÐ»Ð¸ Ð¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ð²ÑƒÐµÑ‚
          if (!chat.mode) {
            chat.mode = "sql";
          }

          // Ð’Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸Ñ: Ð¿Ñ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼, Ñ‡Ñ‚Ð¾ Ñ€ÐµÐ¶Ð¸Ð¼ Ð´Ð¾ÑÑ‚ÑƒÐ¿ÐµÐ½ Ð´Ð»Ñ ÑÑ…ÐµÐ¼Ñ‹
          const chatAvailableModes = getModesForSchema(chat.schema);
          if (!chatAvailableModes[chat.mode]) {
            // Ð ÐµÐ¶Ð¸Ð¼ Ð½ÐµÐ´Ð¾ÑÑ‚ÑƒÐ¿ÐµÐ½ Ð´Ð»Ñ ÑÑ‚Ð¾Ð¹ ÑÑ…ÐµÐ¼Ñ‹
            const firstMode = Object.keys(chatAvailableModes)[0];
            if (firstMode) {
              console.warn(`Chat ${chat.id}: migrating mode from ${chat.mode} to ${firstMode} for schema ${chat.schema}`);
              chat.mode = firstMode;
            } else {
              // Ð¡Ñ…ÐµÐ¼Ð° Ð½Ðµ ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÐµÑ‚ - Ð¼Ð¸Ð³Ñ€Ð¸Ñ€ÑƒÐµÐ¼ Ð½Ð° sozd:sql
              console.warn(`Chat ${chat.id}: schema ${chat.schema} not found, migrating to sozd:sql`);
              chat.schema = 'sozd';
              chat.mode = 'sql';
            }
          }
        });
      }

      return data;
    } catch {}
  }
  const init = { activeChatId: null, chats: [] };
  const chat = createChat("New chat");
  init.chats.push(chat);
  init.activeChatId = chat.id;
  saveState(init);
  return init;
}

export function saveState(next = state) {
  localStorage.setItem(LS_KEY, JSON.stringify(next));
}

/**
 * ÐŸÑ€Ð¸Ð¼ÐµÑ€Ñ‹ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ¾Ð² Ð´Ð»Ñ ÐºÐ°Ð¶Ð´Ð¾Ð¹ ÑÑ…ÐµÐ¼Ñ‹ Ð‘Ð”
 */
const SCHEMA_EXAMPLES = {
  sozd: {
    sql: {
      text: [
        '"ÐŸÐ¾ÐºÐ°Ð¶Ð¸ Ð·Ð°ÐºÐ¾Ð½Ñ‹ Ð¾ Ð½Ð°Ð»Ð¾Ð³Ð°Ñ…"',
        '"ÐÐ°Ð¹Ð´Ð¸ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ñ‹ ÑÐ¾Ð´ÐµÑ€Ð¶Ð°Ñ‰Ð¸Ðµ ÑÐ»Ð¾Ð²Ð¾ \'Ð¾Ð±Ñ€Ð°Ð·Ð¾Ð²Ð°Ð½Ð¸Ðµ\'"'
      ],
      date: [
        '"ÐŸÐ¾ÐºÐ°Ð¶Ð¸ Ð·Ð°ÐºÐ¾Ð½Ñ‹ Ð¿Ñ€Ð¸Ð½ÑÑ‚Ñ‹Ðµ Ð² 2023 Ð³Ð¾Ð´Ñƒ"',
        '"ÐÐ°Ð¹Ð´Ð¸ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ñ‹ Ð¾Ð¿ÑƒÐ±Ð»Ð¸ÐºÐ¾Ð²Ð°Ð½Ð½Ñ‹Ðµ Ð¿Ð¾ÑÐ»Ðµ 1 ÑÐ½Ð²Ð°Ñ€Ñ 2024"'
      ],
      stats: [
        '"ÐŸÐ¾ÑÑ‡Ð¸Ñ‚Ð°Ð¹ ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ Ð·Ð°ÐºÐ¾Ð½Ð¾Ð² Ð¿Ð¾ Ð³Ð¾Ð´Ð°Ð¼"',
        '"ÐŸÐ¾ÐºÐ°Ð¶Ð¸ Ñ‚Ð¾Ð¿ 10 ÑÐ°Ð¼Ñ‹Ñ… Ñ‡Ð°ÑÑ‚Ð¾ Ð²ÑÑ‚Ñ€ÐµÑ‡Ð°ÑŽÑ‰Ð¸Ñ…ÑÑ Ñ‚ÐµÑ€Ð¼Ð¸Ð½Ð¾Ð²"'
      ],
      complex: [
        '"ÐÐ°Ð¹Ð´Ð¸ Ð²ÑÐµ Ð·Ð°ÐºÐ¾Ð½Ñ‹ Ð¾ ÑÑ‚Ñ€Ð¾Ð¸Ñ‚ÐµÐ»ÑŒÑÑ‚Ð²Ðµ Ð¿Ñ€Ð¸Ð½ÑÑ‚Ñ‹Ðµ Ð² 2024 Ð³Ð¾Ð´Ñƒ Ð¸ Ð¾Ñ‚ÑÐ¾Ñ€Ñ‚Ð¸Ñ€ÑƒÐ¹ Ð¿Ð¾ Ð´Ð°Ñ‚Ðµ"'
      ]
    },
    custom: {
      semantic: [
        '"ÐšÐ°Ðº Ñ€ÐµÐ³ÑƒÐ»Ð¸Ñ€ÑƒÐµÑ‚ÑÑ Ð¾Ñ…Ñ€Ð°Ð½Ð° Ñ‚Ñ€ÑƒÐ´Ð°?"',
        '"Ð Ð°ÑÑÐºÐ°Ð¶Ð¸ Ð¾ Ð¿Ñ€Ð°Ð²Ð°Ñ… Ñ€Ð°Ð±Ð¾Ñ‚Ð½Ð¸ÐºÐ¾Ð²"'
      ],
      topics: [
        '"ÐšÐ°ÐºÐ¸Ðµ Ð»ÑŒÐ³Ð¾Ñ‚Ñ‹ Ð¿Ñ€ÐµÐ´ÑƒÑÐ¼Ð¾Ñ‚Ñ€ÐµÐ½Ñ‹ Ð´Ð»Ñ Ð¼Ð½Ð¾Ð³Ð¾Ð´ÐµÑ‚Ð½Ñ‹Ñ… ÑÐµÐ¼ÐµÐ¹?"',
        '"Ð§Ñ‚Ð¾ Ð³Ð¾Ð²Ð¾Ñ€Ð¸Ñ‚ÑÑ Ð¾ Ð½Ð°Ð»Ð¾Ð³Ðµ Ð½Ð° Ð¸Ð¼ÑƒÑ‰ÐµÑÑ‚Ð²Ð¾?"'
      ],
      specific: [
        '"ÐšÐ°ÐºÐ¾Ð¹ ÑˆÑ‚Ñ€Ð°Ñ„ Ð·Ð° Ð½Ð°Ñ€ÑƒÑˆÐµÐ½Ð¸Ðµ ÐŸÐ”Ð”?"',
        '"Ð¡ÐºÐ¾Ð»ÑŒÐºÐ¾ Ð´Ð»Ð¸Ñ‚ÑÑ Ð¾Ñ‚Ð¿ÑƒÑÐº Ð¿Ð¾ Ð±ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ð¾ÑÑ‚Ð¸?"'
      ],
      analytics: [
        '"Ð¡Ñ€Ð°Ð²Ð½Ð¸ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ Ð² Ñ‚Ñ€ÑƒÐ´Ð¾Ð²Ð¾Ð¼ ÐºÐ¾Ð´ÐµÐºÑÐµ Ð·Ð° Ð¿Ð¾ÑÐ»ÐµÐ´Ð½Ð¸Ðµ Ð³Ð¾Ð´Ñ‹"'
      ]
    }
  },
  lib: {
    sql: {
      text: [
        '"ÐŸÐ¾ÐºÐ°Ð¶Ð¸ Ð²ÑÐµ ÐºÐ½Ð¸Ð³Ð¸ Ð”Ð¾ÑÑ‚Ð¾ÐµÐ²ÑÐºÐ¾Ð³Ð¾"',
        '"ÐÐ°Ð¹Ð´Ð¸ Ð¿Ñ€Ð¾Ð¸Ð·Ð²ÐµÐ´ÐµÐ½Ð¸Ñ ÑÐ¾Ð´ÐµÑ€Ð¶Ð°Ñ‰Ð¸Ðµ ÑÐ»Ð¾Ð²Ð¾ \'Ð»ÑŽÐ±Ð¾Ð²ÑŒ\'"'
      ],
      date: [
        '"ÐŸÐ¾ÐºÐ°Ð¶Ð¸ ÐºÐ½Ð¸Ð³Ð¸ Ð¸Ð·Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð² 19 Ð²ÐµÐºÐµ"',
        '"ÐÐ°Ð¹Ð´Ð¸ Ð¿Ñ€Ð¾Ð¸Ð·Ð²ÐµÐ´ÐµÐ½Ð¸Ñ Ð¾Ð¿ÑƒÐ±Ð»Ð¸ÐºÐ¾Ð²Ð°Ð½Ð½Ñ‹Ðµ Ð¿Ð¾ÑÐ»Ðµ 1900 Ð³Ð¾Ð´Ð°"'
      ],
      stats: [
        '"ÐŸÐ¾ÑÑ‡Ð¸Ñ‚Ð°Ð¹ ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ ÐºÐ½Ð¸Ð³ Ð¿Ð¾ Ð°Ð²Ñ‚Ð¾Ñ€Ð°Ð¼"',
        '"ÐŸÐ¾ÐºÐ°Ð¶Ð¸ Ñ‚Ð¾Ð¿ 10 ÑÐ°Ð¼Ñ‹Ñ… Ð¿Ð¾Ð¿ÑƒÐ»ÑÑ€Ð½Ñ‹Ñ… Ð¶Ð°Ð½Ñ€Ð¾Ð²"'
      ],
      complex: [
        '"ÐÐ°Ð¹Ð´Ð¸ Ð²ÑÐµ Ñ€Ð¾Ð¼Ð°Ð½Ñ‹ Ð¾ Ð²Ð¾Ð¹Ð½Ðµ Ð¸Ð·Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð² 20 Ð²ÐµÐºÐµ Ð¸ Ð¾Ñ‚ÑÐ¾Ñ€Ñ‚Ð¸Ñ€ÑƒÐ¹ Ð¿Ð¾ Ð°Ð²Ñ‚Ð¾Ñ€Ñƒ"'
      ]
    },
    custom: {
      semantic: [
        '"Ð Ð°ÑÑÐºÐ°Ð¶Ð¸ Ð¾ Ñ‚Ð²Ð¾Ñ€Ñ‡ÐµÑÑ‚Ð²Ðµ Ð“Ð°Ð°Ð·Ðµ"',
        '"ÐšÐ°ÐºÐ¸Ðµ ÐºÐ½Ð¸Ð³Ð¸ Ð¿Ð¾ÑÐ²ÑÑ‰ÐµÐ½Ñ‹ Ð±Ð»Ð°Ð³Ð¾Ñ‚Ð²Ð¾Ñ€Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚Ð¸?"'
      ],
      topics: [
        '"ÐÐ°Ð¹Ð´Ð¸ Ð¿Ñ€Ð¾Ð¸Ð·Ð²ÐµÐ´ÐµÐ½Ð¸Ñ Ð¾ Ð¼ÐµÐ´Ð¸Ñ†Ð¸Ð½Ðµ Ð² Ð Ð¾ÑÑÐ¸Ð¸"',
        '"Ð§Ñ‚Ð¾ Ð¿Ð¸ÑÐ°Ð»Ð¸ Ð¾ Ñ‚ÑŽÑ€ÐµÐ¼Ð½Ð¾Ð¹ Ñ€ÐµÑ„Ð¾Ñ€Ð¼Ðµ?"'
      ],
      specific: [
        '"ÐšÐ¾Ð³Ð´Ð° Ð“Ð°Ð°Ð·Ðµ Ð½Ð°Ñ‡Ð°Ð» ÑÐ²Ð¾ÑŽ Ð´ÐµÑÑ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚ÑŒ?"',
        '"ÐšÐ°ÐºÐ¸Ðµ Ð½Ð°Ð³Ñ€Ð°Ð´Ñ‹ Ð¿Ð¾Ð»ÑƒÑ‡Ð¸Ð» Ð“Ð°Ð°Ð·Ðµ?"'
      ],
      analytics: [
        '"Ð¡Ñ€Ð°Ð²Ð½Ð¸ Ð¿Ð¾Ð´Ñ…Ð¾Ð´Ñ‹ Ðº Ð±Ð»Ð°Ð³Ð¾Ñ‚Ð²Ð¾Ñ€Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚Ð¸ Ð² Ñ€Ð°Ð·Ð½Ñ‹Ðµ ÑÐ¿Ð¾Ñ…Ð¸"'
      ]
    }
  },
  family: {
    sql: {
      text: [
        '"ÐŸÐ¾ÐºÐ°Ð¶Ð¸ Ñ€Ð°ÑÑ…Ð¾Ð´Ñ‹ Ð² Ð³Ñ€ÑƒÐ¿Ð¿Ðµ 14"',
        '"ÐÐ°Ð¹Ð´Ð¸ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ñ Ñ ÑƒÐºÐ°Ð·Ð°Ð½Ð¸ÐµÐ¼ \'Ð²Ñ€Ð°Ñ‡\'"',
        '"CÐºÐ¾Ð»ÑŒÐºÐ¾ Ñƒ Ð½Ð°Ñ ÑÐµÐ¹Ñ‡Ð°Ñ Ð´ÐµÐ½ÐµÐ³"',
        '"ÑÐºÐ¾Ð»ÑŒÐºÐ¾ Ñƒ Ð½Ð°Ñ ÑÐµÐ¹Ñ‡Ð°Ñ Ð´ÐµÐ½ÐµÐ³. Ð”Ð»Ñ Ð²Ð°Ð»ÑŽÑ‚ Ð¾Ñ‚Ð»Ð¸Ñ‡Ð½Ñ‹Ñ… Ð¾Ñ‚ ÑˆÐµÐºÐµÐ»Ñ ÑƒÐºÐ°Ð¶Ð¸ ÐµÑ‰Ðµ Ð¸ Ð¸Ñ… ÑÐºÐ²Ð¸Ð²Ð°Ð»ÐµÐ½Ñ‚ Ð² ÑˆÐµÐºÐµÐ»ÑÑ… Ð¸ Ð´Ð¾Ð±Ð°Ð²ÑŒ Ð¾ÐºÐ¾Ð½Ñ‡Ð°Ñ‚ÐµÐ»ÑŒÐ½ÑƒÑŽ ÑÑƒÐ¼Ð¼Ñƒ Ð² ÑˆÐµÐºÐµÐ»ÑÑ…"'
      ],
      date: [
        '"ÐŸÐ¾ÐºÐ°Ð¶Ð¸ Ñ€Ð°ÑÑ…Ð¾Ð´Ñ‹ Ð² Ð´ÐµÐºÐ°Ð±Ñ€Ðµ 2025"',
        '"ÐÐ°Ð¹Ð´Ð¸ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ñ Ð¿Ð¾ÑÐ»Ðµ 2025 Ð³Ð¾Ð´Ð°"',
        '"Ð’Ñ‹Ð²ÐµÐ´Ð¸ ÑÑ€ÐµÐ´Ð½ÐµÑÑƒÑ‚Ð¾Ñ‡Ð½ÑƒÑŽ Ñ‚ÐµÐ¼Ð¿ÐµÑ€Ð°Ñ‚ÑƒÑ€Ñƒ Ð² Ð·Ð´Ð°Ð½Ð¸Ð¸ 1 Ð·Ð° Ð´ÐµÐºÐ°Ð±Ñ€ÑŒ 2025"'
      ],
      stats: [
        '"ÐÐ°Ð¹Ð´Ð¸ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ñ Ñ ÑƒÐºÐ°Ð·Ð°Ð½Ð¸ÐµÐ¼ \'Ð¿Ñ€Ð¾Ð³ÑƒÐ»ÐºÐ°\' Ð¸ Ð²Ñ‹Ð´ÐµÐ»Ð¸ Ð² ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ð¸ Ð´Ð»Ð¸Ð½Ñƒ Ð¿Ñ€Ð¾Ð³ÑƒÐ»ÐºÐ¸ ÐºÐ°Ðº Ñ‡Ð¸ÑÐ»Ð¾ (Ð²Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ð¾ Ñ Ñ†Ð¸Ñ„Ñ€Ð°Ð¼Ð¸ Ð¿Ð¾ÑÐ»Ðµ Ñ‚Ð¾Ñ‡ÐºÐ¸) Ð¿ÐµÑ€ÐµÐ´ ÑÐ»Ð¾Ð²Ð¾Ð¼ \'ÐºÐ¼\'"',
        '"ÐŸÐ¾Ð´ÑÑ‡Ð¸Ñ‚Ð°Ð¹ ÑÑƒÐ¼Ð¼Ñƒ Ð´Ð»Ð¸Ð½ \'Ð¿Ñ€Ð¾Ð³ÑƒÐ»ÐºÐ°\' . Ð’ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ð¸ Ð´Ð»Ð¸Ð½Ð° Ð¿Ñ€Ð¾Ð³ÑƒÐ»ÐºÐ¸ ÑÑ‚Ð¾ Ñ‡Ð¸ÑÐ»Ð¾ (Ð²Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ð¾ ÑÐ¾ Ñ†Ð¸Ñ„Ñ€Ð°Ð¼Ð¸ Ð¿Ð¾ÑÐ»Ðµ Ñ‚Ð¾Ñ‡ÐºÐ¸) Ð¿ÐµÑ€ÐµÐ´ ÑÐ»Ð¾Ð²Ð¾Ð¼ \'ÐºÐ¼\'."'
      ],
      complex: [
        'Ð·Ð° ÐºÐ°Ð¶Ð´Ñ‹Ðµ ÑÑƒÑ‚ÐºÐ¸ Ð´ÐµÐºÐ°Ð±Ñ€Ñ 2025 Ð´Ð°Ð¹ ÑÑ€ÐµÐ´Ð½ÐµÑÑƒÑ‚Ð¾Ñ‡Ð½ÑƒÑŽ Ñ‚ÐµÐ¼Ð¿ÐµÑ€Ð°Ñ‚ÑƒÑ€Ñƒ Ð² Ð·Ð´Ð°Ð½Ð¸ÑÑ… 1 Ð¸ 2 Ð² Ð¾Ñ‚Ð´ÐµÐ»ÑŒÐ½Ñ‹Ñ… ÐºÐ¾Ð»Ð¾Ð½ÐºÐ°Ñ…'
      ]
    },
    custom: {
      semantic: [
        '"Ð Ð°ÑÑÐºÐ°Ð¶Ð¸ Ð¾ ÑÐµÐ¼ÐµÐ¹Ð½Ñ‹Ñ… Ñ‚Ñ€Ð°Ð´Ð¸Ñ†Ð¸ÑÑ…"',
        '"ÐšÐ°ÐºÐ¸Ðµ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ñ Ð²Ð°Ð¶Ð½Ñ‹ Ð´Ð»Ñ ÑÐµÐ¼ÑŒÐ¸?"'
      ],
      topics: [
        '"ÐÐ°Ð¹Ð´Ð¸ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸ÑŽ Ð¾ Ð¿Ñ€ÐµÐ´ÐºÐ°Ñ… Ð¸Ð· ÐœÐ¾ÑÐºÐ²Ñ‹"',
        '"Ð§Ñ‚Ð¾ Ð¸Ð·Ð²ÐµÑÑ‚Ð½Ð¾ Ð¾ Ð²Ð¾ÐµÐ½Ð½Ñ‹Ñ… Ð³Ð¾Ð´Ð°Ñ…?"'
      ],
      specific: [
        '"ÐšÐ¾Ð³Ð´Ð° Ñ€Ð¾Ð´Ð¸Ð»ÑÑ Ð¿Ñ€Ð°Ð´ÐµÐ´ Ð˜Ð²Ð°Ð½?"',
        '"ÐšÐ°ÐºÐ¸Ðµ Ð¿Ñ€Ð¾Ñ„ÐµÑÑÐ¸Ð¸ Ð±Ñ‹Ð»Ð¸ Ð² ÑÐµÐ¼ÑŒÐµ?"'
      ],
      analytics: [
        '"ÐšÐ°Ðº Ð¼ÐµÐ½ÑÐ»Ð°ÑÑŒ Ð³ÐµÐ¾Ð³Ñ€Ð°Ñ„Ð¸Ñ Ð¿Ñ€Ð¾Ð¶Ð¸Ð²Ð°Ð½Ð¸Ñ ÑÐµÐ¼ÑŒÐ¸?"'
      ]
    }
  },
  urban: {
    sql: {
      text: [
        '"ÐŸÐ¾ÐºÐ°Ð¶Ð¸ Ð²ÑÐµ Ð»Ð¾ÐºÐ°Ñ†Ð¸Ð¸ Ñ Ñ‚Ð¸Ð¿Ð¾Ð¼ \'Ð¿Ð°Ñ€Ðº\'"',
        '"ÐÐ°Ð¹Ð´Ð¸ Ð¾Ð±ÑŠÐµÐºÑ‚Ñ‹ ÑÐ¾Ð´ÐµÑ€Ð¶Ð°Ñ‰Ð¸Ðµ ÑÐ»Ð¾Ð²Ð¾ \'Ð¿Ð»Ð¾Ñ‰Ð°Ð´ÑŒ\'"'
      ],
      date: [
        '"ÐŸÐ¾ÐºÐ°Ð¶Ð¸ Ð·Ð´Ð°Ð½Ð¸Ñ Ð¿Ð¾ÑÑ‚Ñ€Ð¾ÐµÐ½Ð½Ñ‹Ðµ Ð² 2020 Ð³Ð¾Ð´Ñƒ"',
        '"ÐÐ°Ð¹Ð´Ð¸ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ñ Ð¿Ð¾ÑÐ»Ðµ 1 ÑÐ½Ð²Ð°Ñ€Ñ 2023"'
      ],
      stats: [
        '"ÐŸÐ¾ÑÑ‡Ð¸Ñ‚Ð°Ð¹ ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ Ð¾Ð±ÑŠÐµÐºÑ‚Ð¾Ð² Ð¿Ð¾ Ñ€Ð°Ð¹Ð¾Ð½Ð°Ð¼"',
        '"ÐŸÐ¾ÐºÐ°Ð¶Ð¸ Ñ‚Ð¾Ð¿ 10 ÑÐ°Ð¼Ñ‹Ñ… Ð¿Ð¾ÑÐµÑ‰Ð°ÐµÐ¼Ñ‹Ñ… Ð¼ÐµÑÑ‚"'
      ],
      complex: [
        '"ÐÐ°Ð¹Ð´Ð¸ Ð²ÑÐµ Ð¿Ð°Ð¼ÑÑ‚Ð½Ð¸ÐºÐ¸ Ð² Ñ†ÐµÐ½Ñ‚Ñ€Ðµ Ð¿Ð¾ÑÑ‚Ñ€Ð¾ÐµÐ½Ð½Ñ‹Ðµ Ð´Ð¾ 1917 Ð³Ð¾Ð´Ð° Ð¸ Ð¾Ñ‚ÑÐ¾Ñ€Ñ‚Ð¸Ñ€ÑƒÐ¹ Ð¿Ð¾ Ð´Ð°Ñ‚Ðµ"'
      ]
    },
    custom: {
      semantic: [
        '"Ð Ð°ÑÑÐºÐ°Ð¶Ð¸ Ð¾Ð± Ð¸ÑÑ‚Ð¾Ñ€Ð¸Ð¸ ÑÑ‚Ð¾Ð³Ð¾ Ñ€Ð°Ð¹Ð¾Ð½Ð°"',
        '"ÐšÐ°ÐºÐ¸Ðµ Ð´Ð¾ÑÑ‚Ð¾Ð¿Ñ€Ð¸Ð¼ÐµÑ‡Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚Ð¸ ÐµÑÑ‚ÑŒ Ð¿Ð¾Ð±Ð»Ð¸Ð·Ð¾ÑÑ‚Ð¸?"'
      ],
      topics: [
        '"ÐÐ°Ð¹Ð´Ð¸ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸ÑŽ Ð¾ ÐºÑƒÐ»ÑŒÑ‚ÑƒÑ€Ð½Ñ‹Ñ… Ñ†ÐµÐ½Ñ‚Ñ€Ð°Ñ…"',
        '"Ð§Ñ‚Ð¾ Ð¸Ð½Ñ‚ÐµÑ€ÐµÑÐ½Ð¾Ð³Ð¾ Ð² ÑÑ‚Ð¾Ð¼ ÐºÐ²Ð°Ñ€Ñ‚Ð°Ð»Ðµ?"'
      ],
      specific: [
        '"ÐšÐ¾Ð³Ð´Ð° Ð¿Ð¾ÑÑ‚Ñ€Ð¾Ð¸Ð»Ð¸ ÑÑ‚Ð¾ Ð·Ð´Ð°Ð½Ð¸Ðµ?"',
        '"ÐšÐ°ÐºÐ¸Ðµ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ñ Ð¿Ñ€Ð¾Ñ…Ð¾Ð´ÑÑ‚ Ð² Ð¿Ð°Ñ€ÐºÐµ?"'
      ],
      analytics: [
        '"ÐšÐ°Ðº Ð¼ÐµÐ½ÑÐ»ÑÑ Ð³Ð¾Ñ€Ð¾Ð´ÑÐºÐ¾Ð¹ Ð»Ð°Ð½Ð´ÑˆÐ°Ñ„Ñ‚ Ð·Ð° Ð¿Ð¾ÑÐ»ÐµÐ´Ð½Ð¸Ðµ Ð³Ð¾Ð´Ñ‹?"'
      ]
    }
  },
  eco: {
    sql: {
      text: [
        '"ÐŸÐ¾ÐºÐ°Ð¶Ð¸ Ð²ÑÐµ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð¾ Ð·Ð°Ð³Ñ€ÑÐ·Ð½ÐµÐ½Ð¸Ð¸ Ð²Ð¾Ð·Ð´ÑƒÑ…Ð°"',
        '"ÐÐ°Ð¹Ð´Ð¸ Ð·Ð°Ð¿Ð¸ÑÐ¸ ÑÐ¾Ð´ÐµÑ€Ð¶Ð°Ñ‰Ð¸Ðµ \'Ð·Ð°Ð¿Ð¾Ð²ÐµÐ´Ð½Ð¸Ðº\'"'
      ],
      date: [
        '"ÐŸÐ¾ÐºÐ°Ð¶Ð¸ Ð¸Ð·Ð¼ÐµÑ€ÐµÐ½Ð¸Ñ Ð·Ð° 2023 Ð³Ð¾Ð´"',
        '"ÐÐ°Ð¹Ð´Ð¸ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð¿Ð¾ÑÐ»Ðµ 1 ÑÐ½Ð²Ð°Ñ€Ñ 2024"'
      ],
      stats: [
        '"ÐŸÐ¾ÑÑ‡Ð¸Ñ‚Ð°Ð¹ ÑÑ€ÐµÐ´Ð½ÑŽÑŽ Ñ‚ÐµÐ¼Ð¿ÐµÑ€Ð°Ñ‚ÑƒÑ€Ñƒ Ð¿Ð¾ Ð¼ÐµÑÑÑ†Ð°Ð¼"',
        '"ÐŸÐ¾ÐºÐ°Ð¶Ð¸ Ñ‚Ð¾Ð¿ 10 ÑÐ°Ð¼Ñ‹Ñ… Ð·Ð°Ð³Ñ€ÑÐ·Ð½ÐµÐ½Ð½Ñ‹Ñ… Ñ€Ð°Ð¹Ð¾Ð½Ð¾Ð²"'
      ],
      complex: [
        '"ÐÐ°Ð¹Ð´Ð¸ Ð²ÑÐµ Ð¸Ð·Ð¼ÐµÑ€ÐµÐ½Ð¸Ñ CO2 Ð²Ñ‹ÑˆÐµ Ð½Ð¾Ñ€Ð¼Ñ‹ Ð·Ð° Ð¿Ð¾ÑÐ»ÐµÐ´Ð½Ð¸Ð¹ Ð³Ð¾Ð´ Ð¸ Ð¾Ñ‚ÑÐ¾Ñ€Ñ‚Ð¸Ñ€ÑƒÐ¹ Ð¿Ð¾ Ð´Ð°Ñ‚Ðµ"'
      ]
    },
    custom: {
      semantic: [
        '"ÐšÐ°Ðº Ð¸Ð·Ð¼ÐµÐ½Ð¸Ð»ÑÑ ÐºÐ»Ð¸Ð¼Ð°Ñ‚ Ð² Ñ€ÐµÐ³Ð¸Ð¾Ð½Ðµ?"',
        '"Ð Ð°ÑÑÐºÐ°Ð¶Ð¸ Ð¾ ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ð¸ ÑÐºÐ¾ÑÐ¸ÑÑ‚ÐµÐ¼Ñ‹"'
      ],
      topics: [
        '"ÐšÐ°ÐºÐ¸Ðµ Ð²Ð¸Ð´Ñ‹ Ð¶Ð¸Ð²Ð¾Ñ‚Ð½Ñ‹Ñ… Ð¿Ð¾Ð´ ÑƒÐ³Ñ€Ð¾Ð·Ð¾Ð¹?"',
        '"Ð§Ñ‚Ð¾ Ð´ÐµÐ»Ð°ÐµÑ‚ÑÑ Ð´Ð»Ñ Ð¾Ñ…Ñ€Ð°Ð½Ñ‹ Ð¿Ñ€Ð¸Ñ€Ð¾Ð´Ñ‹?"'
      ],
      specific: [
        '"ÐšÐ°ÐºÐ¾Ð¹ ÑƒÑ€Ð¾Ð²ÐµÐ½ÑŒ Ð·Ð°Ð³Ñ€ÑÐ·Ð½ÐµÐ½Ð¸Ñ ÑÐµÐ³Ð¾Ð´Ð½Ñ?"',
        '"Ð¡ÐºÐ¾Ð»ÑŒÐºÐ¾ Ð·Ð°Ð¿Ð¾Ð²ÐµÐ´Ð½Ð¸ÐºÐ¾Ð² Ð² Ñ€ÐµÐ³Ð¸Ð¾Ð½Ðµ?"'
      ],
      analytics: [
        '"Ð¡Ñ€Ð°Ð²Ð½Ð¸ ÑÐºÐ¾Ð»Ð¾Ð³Ð¸Ñ‡ÐµÑÐºÑƒÑŽ ÑÐ¸Ñ‚ÑƒÐ°Ñ†Ð¸ÑŽ Ð·Ð° Ñ€Ð°Ð·Ð½Ñ‹Ðµ Ð³Ð¾Ð´Ñ‹"'
      ]
    }
  },
  gen: {
    sql: {
      text: [
        '"ÐŸÐ¾ÐºÐ°Ð¶Ð¸ Ð²ÑÐµ Ð·Ð°Ð¿Ð¸ÑÐ¸ Ð¾ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸ÑÑ…"',
        '"ÐÐ°Ð¹Ð´Ð¸ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ñ‹ ÑÐ¾Ð´ÐµÑ€Ð¶Ð°Ñ‰Ð¸Ðµ ÑÐ»Ð¾Ð²Ð¾ \'Ð²ÑÑ‚Ñ€ÐµÑ‡Ð°\'"'
      ],
      date: [
        '"ÐŸÐ¾ÐºÐ°Ð¶Ð¸ Ð·Ð°Ð¿Ð¸ÑÐ¸ Ð·Ð° 2023 Ð³Ð¾Ð´"',
        '"ÐÐ°Ð¹Ð´Ð¸ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ñ Ð¿Ð¾ÑÐ»Ðµ 1 ÑÐ½Ð²Ð°Ñ€Ñ 2024"'
      ],
      stats: [
        '"ÐŸÐ¾ÑÑ‡Ð¸Ñ‚Ð°Ð¹ ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ Ð·Ð°Ð¿Ð¸ÑÐµÐ¹ Ð¿Ð¾ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸ÑÐ¼"',
        '"ÐŸÐ¾ÐºÐ°Ð¶Ð¸ Ñ‚Ð¾Ð¿ 10 ÑÐ°Ð¼Ñ‹Ñ… Ñ‡Ð°ÑÑ‚Ñ‹Ñ… Ñ‚ÐµÐ¼"'
      ],
      complex: [
        '"ÐÐ°Ð¹Ð´Ð¸ Ð²ÑÐµ Ð²Ð°Ð¶Ð½Ñ‹Ðµ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ñ Ð·Ð° Ð¿Ð¾ÑÐ»ÐµÐ´Ð½Ð¸Ð¹ Ð¼ÐµÑÑÑ† Ð¸ Ð¾Ñ‚ÑÐ¾Ñ€Ñ‚Ð¸Ñ€ÑƒÐ¹ Ð¿Ð¾ Ð´Ð°Ñ‚Ðµ"'
      ]
    },
    custom: {
      semantic: [
        '"Ð Ð°ÑÑÐºÐ°Ð¶Ð¸ Ð¾ Ð²Ð°Ð¶Ð½Ñ‹Ñ… Ð¼Ð¾Ð¼ÐµÐ½Ñ‚Ð°Ñ…"',
        '"ÐšÐ°ÐºÐ¸Ðµ Ð¿Ð»Ð°Ð½Ñ‹ Ð½Ð° Ð±ÑƒÐ´ÑƒÑ‰ÐµÐµ?"'
      ],
      topics: [
        '"ÐÐ°Ð¹Ð´Ð¸ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸ÑŽ Ð¾ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°Ñ…"',
        '"Ð§Ñ‚Ð¾ Ð±Ñ‹Ð»Ð¾ Ð¸Ð½Ñ‚ÐµÑ€ÐµÑÐ½Ð¾Ð³Ð¾?"'
      ],
      specific: [
        '"ÐšÐ¾Ð³Ð´Ð° Ð±Ñ‹Ð»Ð¾ ÑÑ‚Ð¾ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ðµ?"',
        '"ÐšÐ°ÐºÐ¸Ðµ Ð´Ð¾ÑÑ‚Ð¸Ð¶ÐµÐ½Ð¸Ñ ÐµÑÑ‚ÑŒ?"'
      ],
      analytics: [
        '"ÐšÐ°Ðº Ð¼ÐµÐ½ÑÐ»Ð¸ÑÑŒ Ð¿Ñ€Ð¸Ð¾Ñ€Ð¸Ñ‚ÐµÑ‚Ñ‹ ÑÐ¾ Ð²Ñ€ÐµÐ¼ÐµÐ½ÐµÐ¼?"'
      ]
    }
  },
  ohi: {
    sql: {
      text: [
        '"ÐŸÐ¾ÐºÐ°Ð¶Ð¸ Ð²ÑÐµÑ… ÑƒÑ‡Ð°ÑÑ‚Ð½Ð¸ÐºÐ¾Ð² Ð¿Ñ€Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ñ‹"',
        '"ÐÐ°Ð¹Ð´Ð¸ Ð·Ð°Ð¿Ð¸ÑÐ¸ ÑÐ¾Ð´ÐµÑ€Ð¶Ð°Ñ‰Ð¸Ðµ \'Ñ€ÐµÐ¿Ð°Ñ‚Ñ€Ð¸Ð°Ñ†Ð¸Ñ\'"'
      ],
      date: [
        '"ÐŸÐ¾ÐºÐ°Ð¶Ð¸ Ð·Ð°ÑÐ²ÐºÐ¸ Ð¿Ð¾Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð² 2023 Ð³Ð¾Ð´Ñƒ"',
        '"ÐÐ°Ð¹Ð´Ð¸ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ñ‹ Ð¿Ð¾ÑÐ»Ðµ 1 ÑÐ½Ð²Ð°Ñ€Ñ 2024"'
      ],
      stats: [
        '"ÐŸÐ¾ÑÑ‡Ð¸Ñ‚Ð°Ð¹ ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ ÑƒÑ‡Ð°ÑÑ‚Ð½Ð¸ÐºÐ¾Ð² Ð¿Ð¾ ÑÑ‚Ñ€Ð°Ð½Ð°Ð¼"',
        '"ÐŸÐ¾ÐºÐ°Ð¶Ð¸ Ñ‚Ð¾Ð¿ 10 ÑÐ°Ð¼Ñ‹Ñ… Ð¿Ð¾Ð¿ÑƒÐ»ÑÑ€Ð½Ñ‹Ñ… Ð¿Ñ€Ð¾Ð³Ñ€Ð°Ð¼Ð¼"'
      ],
      complex: [
        '"ÐÐ°Ð¹Ð´Ð¸ Ð²ÑÐµÑ… ÑƒÑ‡Ð°ÑÑ‚Ð½Ð¸ÐºÐ¾Ð² Ð¸Ð· Ð Ð¾ÑÑÐ¸Ð¸ Ð¿Ñ€Ð¸Ð½ÑÑ‚Ñ‹Ñ… Ð² Ð¿Ñ€Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ñƒ Ð² 2024 Ð³Ð¾Ð´Ñƒ Ð¸ Ð¾Ñ‚ÑÐ¾Ñ€Ñ‚Ð¸Ñ€ÑƒÐ¹ Ð¿Ð¾ Ð´Ð°Ñ‚Ðµ"'
      ]
    },
    custom: {
      semantic: [
        '"ÐšÐ°Ðº Ð¿Ñ€Ð¾Ñ…Ð¾Ð´Ð¸Ñ‚ Ð¿Ñ€Ð¾Ñ†ÐµÑÑ Ñ€ÐµÐ¿Ð°Ñ‚Ñ€Ð¸Ð°Ñ†Ð¸Ð¸?"',
        '"Ð Ð°ÑÑÐºÐ°Ð¶Ð¸ Ð¾ Ð¿Ñ€Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ð°Ñ… Ð¿Ð¾Ð´Ð´ÐµÑ€Ð¶ÐºÐ¸"'
      ],
      topics: [
        '"ÐšÐ°ÐºÐ¸Ðµ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ñ‹ Ð½ÑƒÐ¶Ð½Ñ‹ Ð´Ð»Ñ Ð¿ÐµÑ€ÐµÐµÐ·Ð´Ð°?"',
        '"Ð§Ñ‚Ð¾ Ð¿Ñ€ÐµÐ´Ð»Ð°Ð³Ð°ÐµÑ‚ÑÑ Ð½Ð¾Ð²Ñ‹Ð¼ Ñ€ÐµÐ¿Ð°Ñ‚Ñ€Ð¸Ð°Ð½Ñ‚Ð°Ð¼?"'
      ],
      specific: [
        '"Ð¡ÐºÐ¾Ð»ÑŒÐºÐ¾ Ð´Ð»Ð¸Ñ‚ÑÑ Ð¿Ñ€Ð¾Ñ†ÐµÑÑ Ð¾Ð´Ð¾Ð±Ñ€ÐµÐ½Ð¸Ñ?"',
        '"ÐšÐ°ÐºÐ°Ñ Ð¿Ð¾Ð¼Ð¾Ñ‰ÑŒ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð° ÑÐµÐ¼ÑŒÑÐ¼?"'
      ],
      analytics: [
        '"Ð¡Ñ€Ð°Ð²Ð½Ð¸ ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ Ñ€ÐµÐ¿Ð°Ñ‚Ñ€Ð¸Ð°Ð½Ñ‚Ð¾Ð² Ð·Ð° Ñ€Ð°Ð·Ð½Ñ‹Ðµ Ð³Ð¾Ð´Ñ‹"'
      ]
    }
  }
};

/**
 * Ð“ÐµÐ½ÐµÑ€Ð¸Ñ€ÑƒÐµÑ‚ Ð¿Ñ€Ð¸Ð²ÐµÑ‚ÑÑ‚Ð²ÐµÐ½Ð½Ð¾Ðµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ñ Ð¿Ñ€Ð¸Ð¼ÐµÑ€Ð°Ð¼Ð¸ Ð´Ð»Ñ Ñ€ÐµÐ¶Ð¸Ð¼Ð°
 * @param {Object} modeConfig - ÐšÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ñ Ñ€ÐµÐ¶Ð¸Ð¼Ð°
 * @param {string} schemaValue - Ð—Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ ÑÑ…ÐµÐ¼Ñ‹ Ð‘Ð”
 * @returns {string} - ÐŸÑ€Ð¸Ð²ÐµÑ‚ÑÑ‚Ð²ÐµÐ½Ð½Ð¾Ðµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ñ Ð¿Ñ€Ð¸Ð¼ÐµÑ€Ð°Ð¼Ð¸
 */
export function getWelcomeMessage(modeConfig, schemaValue) {
  if (!modeConfig) return "ÐŸÑ€Ð¸Ð²ÐµÑ‚! Ð§ÐµÐ¼ Ð¼Ð¾Ð³Ñƒ Ð¿Ð¾Ð¼Ð¾Ñ‡ÑŒ?";

  const schemaLabel = SCHEMA_MODES[schemaValue]?.label || schemaValue;
  const examples = SCHEMA_EXAMPLES[schemaValue] || SCHEMA_EXAMPLES.sozd; // Fallback Ð½Ð° Ð¿Ñ€Ð¸Ð¼ÐµÑ€Ñ‹ sozd

  // ÐŸÑ€Ð¸Ð²ÐµÑ‚ÑÑ‚Ð²ÐµÐ½Ð½Ð¾Ðµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð´Ð»Ñ SQL Ñ€ÐµÐ¶Ð¸Ð¼Ð°
  if (modeConfig.id === 'sql') {
    const sqlExamples = examples.sql;
    return `ðŸ‘‹ Ð”Ð¾Ð±Ñ€Ð¾ Ð¿Ð¾Ð¶Ð°Ð»Ð¾Ð²Ð°Ñ‚ÑŒ Ð² **SQL Ñ€ÐµÐ¶Ð¸Ð¼** Ð´Ð»Ñ ÑÑ…ÐµÐ¼Ñ‹ **${schemaLabel}**!

Ð¯ Ð¿Ð¾Ð¼Ð¾Ð³Ñƒ Ð²Ð°Ð¼ Ð³ÐµÐ½ÐµÑ€Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ SQL Ð·Ð°Ð¿Ñ€Ð¾ÑÑ‹ Ð½Ð° ÐµÑÑ‚ÐµÑÑ‚Ð²ÐµÐ½Ð½Ð¾Ð¼ ÑÐ·Ñ‹ÐºÐµ. ÐŸÑ€Ð¾ÑÑ‚Ð¾ Ð¾Ð¿Ð¸ÑˆÐ¸Ñ‚Ðµ Ñ‡Ñ‚Ð¾ Ð²Ñ‹ Ñ…Ð¾Ñ‚Ð¸Ñ‚Ðµ Ð½Ð°Ð¹Ñ‚Ð¸, Ð¸ Ñ ÑÐ¾Ð·Ð´Ð°Ð¼ SQL Ð·Ð°Ð¿Ñ€Ð¾Ñ Ð¸ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÑŽ ÐµÐ³Ð¾.

**ÐŸÑ€Ð¸Ð¼ÐµÑ€Ñ‹ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ¾Ð²:**

ðŸ“Œ **ÐŸÐ¾Ð¸ÑÐº Ð¿Ð¾ Ñ‚ÐµÐºÑÑ‚Ñƒ:**
${sqlExamples.text.map(ex => `- ${ex}`).join('\n')}

ðŸ“Œ **Ð¤Ð¸Ð»ÑŒÑ‚Ñ€Ð°Ñ†Ð¸Ñ Ð¿Ð¾ Ð´Ð°Ñ‚Ðµ:**
${sqlExamples.date.map(ex => `- ${ex}`).join('\n')}

ðŸ“Œ **Ð¡Ñ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ° Ð¸ Ð°Ð½Ð°Ð»Ð¸Ñ‚Ð¸ÐºÐ°:**
${sqlExamples.stats.map(ex => `- ${ex}`).join('\n')}

ðŸ“Œ **Ð¡Ð»Ð¾Ð¶Ð½Ñ‹Ðµ Ð·Ð°Ð¿Ñ€Ð¾ÑÑ‹:**
${sqlExamples.complex.map(ex => `- ${ex}`).join('\n')}

â—Ð•ÑÐ»Ð¸ Ð½ÑƒÐ¶Ð½Ð¾ Ð¿Ð¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ Ð²ÐµÑÑŒ ÑÐ¿Ð¸ÑÐ¾Ðº (Ð° Ð½Ðµ 10 ÑÑ‚Ñ€Ð¾Ðº) â€” Ð´Ð¾Ð±Ð°Ð²ÑŒÑ‚Ðµ Ð² Ð·Ð°Ð¿Ñ€Ð¾Ñ "Ð±ÐµÐ· Ð»Ð¸Ð¼Ð¸Ñ‚Ð°" Ð¸Ð»Ð¸ ÑƒÐºÐ°Ð¶Ð¸Ñ‚Ðµ Ð½ÑƒÐ¶Ð½Ð¾Ðµ ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ ÑÑ‚Ñ€Ð¾Ðº.
â—â—Ð˜Ð¼ÐµÐ¹Ñ‚Ðµ Ð²Ð²Ð¸Ð´Ñƒ, Ñ‡Ñ‚Ð¾ Ð·Ð°Ð¿Ñ€Ð¾Ñ Ð±ÐµÐ· Ð»Ð¸Ð¼Ð¸Ñ‚Ð° Ð¼Ð¾Ð¶ÐµÑ‚ Ð·Ð°Ð½ÑÑ‚ÑŒ Ð±Ð¾Ð»ÑŒÑˆÐµ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð¸ Ð½Ð° Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ðµ Ð¸ Ð½Ð° Ð²Ñ‹Ð²Ð¾Ð´ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ð¸.

ÐŸÐ¾Ð¿Ñ€Ð¾Ð±ÑƒÐ¹Ñ‚Ðµ Ð·Ð°Ð´Ð°Ñ‚ÑŒ ÑÐ²Ð¾Ð¹ Ð²Ð¾Ð¿Ñ€Ð¾Ñ! ðŸš€`;
  }

  // ÐŸÑ€Ð¸Ð²ÐµÑ‚ÑÑ‚Ð²ÐµÐ½Ð½Ð¾Ðµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð´Ð»Ñ Custom Ñ€ÐµÐ¶Ð¸Ð¼Ð°
  if (modeConfig.id === 'custom') {
    const customExamples = examples.custom;
    return `ðŸ‘‹ Ð”Ð¾Ð±Ñ€Ð¾ Ð¿Ð¾Ð¶Ð°Ð»Ð¾Ð²Ð°Ñ‚ÑŒ Ð² **Custom Ñ€ÐµÐ¶Ð¸Ð¼** Ð´Ð»Ñ ÑÑ…ÐµÐ¼Ñ‹ **${schemaLabel}**!

Ð¯ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÑŽ Ð²ÐµÐºÑ‚Ð¾Ñ€Ð½Ñ‹Ð¹ Ð¿Ð¾Ð¸ÑÐº Ð¸ AI Ð´Ð»Ñ Ð¿Ð¾Ð¸ÑÐºÐ° Ñ€ÐµÐ»ÐµÐ²Ð°Ð½Ñ‚Ð½Ð¾Ð¹ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ð¸ Ð² Ð±Ð°Ð·Ðµ Ð´Ð°Ð½Ð½Ñ‹Ñ…. Ð’Ñ‹ Ð¼Ð¾Ð¶ÐµÑ‚Ðµ Ð·Ð°Ð´Ð°Ð²Ð°Ñ‚ÑŒ Ð²Ð¾Ð¿Ñ€Ð¾ÑÑ‹ Ð¸ Ð¿Ð¾Ð»ÑƒÑ‡Ð°Ñ‚ÑŒ Ð¾Ñ‚Ð²ÐµÑ‚Ñ‹ Ñ ÐºÐ¾Ð½Ñ‚ÐµÐºÑÑ‚Ð¾Ð¼ Ð¸Ð· Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð¾Ð².

**ÐŸÑ€Ð¸Ð¼ÐµÑ€Ñ‹ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ¾Ð²:**

ðŸ“Œ **Ð¡ÐµÐ¼Ð°Ð½Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹ Ð¿Ð¾Ð¸ÑÐº:**
${customExamples.semantic.map(ex => `- ${ex}`).join('\n')}

ðŸ“Œ **Ð’Ð¾Ð¿Ñ€Ð¾ÑÑ‹ Ð¿Ð¾ Ñ‚ÐµÐ¼Ð°Ð¼:**
${customExamples.topics.map(ex => `- ${ex}`).join('\n')}

ðŸ“Œ **ÐŸÐ¾Ð¸ÑÐº ÐºÐ¾Ð½ÐºÑ€ÐµÑ‚Ð¸ÐºÐ¸:**
${customExamples.specific.map(ex => `- ${ex}`).join('\n')}

ðŸ“Œ **ÐÐ½Ð°Ð»Ð¸Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ðµ Ð²Ð¾Ð¿Ñ€Ð¾ÑÑ‹:**
${customExamples.analytics.map(ex => `- ${ex}`).join('\n')}

**Ð”Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹Ðµ Ñ€ÐµÐ¶Ð¸Ð¼Ñ‹ Ð¿Ñ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€Ð°:**
- **Embeddings** - Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹ Ð²ÐµÐºÑ‚Ð¾Ñ€Ð½Ð¾Ð³Ð¾ Ð¿Ð¾Ð¸ÑÐºÐ° Ð¿Ð¾ Ñ€ÐµÐ»ÐµÐ²Ð°Ð½Ñ‚Ð½Ð¾ÑÑ‚Ð¸
- **Analiz** - ÑÐ²Ð¾Ð´Ð½Ñ‹Ð¹ Ð¾Ñ‚Ð²ÐµÑ‚ AI Ð½Ð° Ð¾ÑÐ½Ð¾Ð²Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½Ð½Ñ‹Ñ… Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð¾Ð²

Ð—Ð°Ð´Ð°Ð¹Ñ‚Ðµ ÑÐ²Ð¾Ð¹ Ð²Ð¾Ð¿Ñ€Ð¾Ñ! ðŸ”`;
  }

  // Ð”ÐµÑ„Ð¾Ð»Ñ‚Ð½Ð¾Ðµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð´Ð»Ñ Ð´Ñ€ÑƒÐ³Ð¸Ñ… Ñ€ÐµÐ¶Ð¸Ð¼Ð¾Ð²
  return `ÐŸÑ€Ð¸Ð²ÐµÑ‚! Ð ÐµÐ¶Ð¸Ð¼: ${modeConfig.label}. ${modeConfig.description}`;
}

export function createChat(title, schema = null, mode = null) {
  const currentSchema = schema || dbSchema;
  const currentMode = mode || queryMode;
  const modeConfig = getModeConfig(currentSchema, currentMode);

  // Fallback Ð½Ð° Ð¿ÐµÑ€Ð²Ñ‹Ð¹ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹Ð¹ Ñ€ÐµÐ¶Ð¸Ð¼, ÐµÑÐ»Ð¸ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ñ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½Ð°
  const fallbackModeConfig = modeConfig || (() => {
    const availableModes = getModesForSchema(currentSchema);
    const firstModeId = Object.keys(availableModes)[0];
    return availableModes[firstModeId];
  })();

  return {
    id: crypto.randomUUID(),
    title,
    schema: currentSchema, // ÐŸÑ€Ð¸Ð²ÑÐ·Ñ‹Ð²Ð°ÐµÐ¼ Ñ‡Ð°Ñ‚ Ðº ÑÑ…ÐµÐ¼Ðµ Ð‘Ð”
    mode: currentMode, // ÐŸÑ€Ð¸Ð²ÑÐ·Ñ‹Ð²Ð°ÐµÐ¼ Ñ‡Ð°Ñ‚ Ðº Ñ€ÐµÐ¶Ð¸Ð¼Ñƒ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹
    createdAt: Date.now(),
    messages: [
      {
        id: crypto.randomUUID(),
        role: "assistant",
        content: getWelcomeMessage(fallbackModeConfig, currentSchema)
      }
    ]
  };
}

export function getActiveChat() {
  const found = state.chats.find(c => c.id === state.activeChatId);
  if (found) return found;

  // Ð•ÑÐ»Ð¸ Ð°ÐºÑ‚Ð¸Ð²Ð½Ñ‹Ð¹ Ñ‡Ð°Ñ‚ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½, Ð¸Ñ‰ÐµÐ¼ Ð¿ÐµÑ€Ð²Ñ‹Ð¹ Ñ‡Ð°Ñ‚ Ñ‚ÐµÐºÑƒÑ‰ÐµÐ¹ ÑÑ…ÐµÐ¼Ñ‹
  const schemaChats = state.chats.filter(c => c.schema === dbSchema);
  if (schemaChats.length > 0) {
    state.activeChatId = schemaChats[0].id;
    saveState();
    return schemaChats[0];
  }

  // Ð•ÑÐ»Ð¸ Ð½ÐµÑ‚ Ñ‡Ð°Ñ‚Ð¾Ð² Ð´Ð»Ñ Ñ‚ÐµÐºÑƒÑ‰ÐµÐ¹ ÑÑ…ÐµÐ¼Ñ‹, Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÐ¼ Ð¿ÐµÑ€Ð²Ñ‹Ð¹ Ñ‡Ð°Ñ‚ (Ð»ÑŽÐ±Ð¾Ð¹ ÑÑ…ÐµÐ¼Ñ‹)
  state.activeChatId = state.chats[0]?.id || null;
  saveState();
  return state.chats[0];
}

export function getSchemaChats() {
  return state.chats.filter(c => c.schema === dbSchema);
}
